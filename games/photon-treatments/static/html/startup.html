<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <div id="video-wrapper">
    <div id="click-target" class="interaction"></div>
    <video id="video-test" preload="auto" width="1366" height="768" class="hidden"></video>
    <div id="step-complete" class="hidden">
      <h1>Animation completed!</h1>
      <p>Would you like to watch it again?</p>
      <button id="reset">Review</button>
      <button id="end-trial">Continue</button>
    </div>
  <div>

  <script type="text/javascript">
    var vid = document.getElementById('video-test');
    var click_target = document.getElementById('click-target');
    var step_complete = document.getElementById('step-complete');
    var reset = document.getElementById('reset');
    var timeouts = [];

    if (jsPsych.currentTrial().data.treatment_type === 'new tab') {
      click_target.classList.add('new-tab');
    } else {
      click_target.classList.remove('new-tab');
    }

    // pre-load entire video
    vid.src = jsPsych.currentTrial().data.video_url;
    vid.load();
    vid.addEventListener('loadeddata', function(e){
      vid.classList.remove('hidden');
    });

    reset.onclick = function() {
      for (var i = 0; i < timeouts.length; i++) {
          clearTimeout(timeouts[i]);
      }
      click_target.classList.remove('hidden');
      vid.currentTime = 0;
      vid.pause();
      step_complete.classList.add('hidden');
      timeouts = [];
    }

    click_target.onclick = function () {
      click_target.classList.add('hidden');
      vid.play();
      vid.onended = function () {
        step_complete.classList.remove('hidden');
      };
    }

  </script>
</body>

</html>
